<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/MainHeader.ejs') %>
</head>

<body>
    <div class="container-xxl position-relative bg-white d-flex p-0">
        <!-- Spinner Start -->
        <%- include('../partials/spinner.ejs') %>
            <!-- Spinner End -->


            <!-- Sidebar Start -->
            <%- include('../partials/adminSidebar.ejs')%>
                <!-- Sidebar End -->


                <!-- Content Start -->
                <div class="content">
                    <!-- Navbar Start -->
                    <%- include('../partials/navbar.ejs')%>
                        <!-- Navbar End -->

                        <div class="col-sm-12 col-xl-12 pt-4 px-4">
                            <%- include("../partials/flashMessage.ejs") %>
                        </div>

                        <!-- Blank Start -->
                        <div class="container-fluid pt-4 px-4">

                            <div class="row bg-light rounded justify-content-center m-0 p-2" style="min-height: 70vh;">
                                <div class="row">
                                    <!-- List starts Here     -->
                                    <div class="col-12">
                                        <div class="bg-light rounded h-100 p-0">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-flex gap-2 justify-content-center align-items-center">
                                                    <h6 class="my-3 ">
                                                        All Recent Grievances
                                                    </h6>
                                                </div>
                                                <!-- <div>
                                                    <input type="text" class="form-control my-3" id="searchSession"
                                                        placeholder="Search by Session">

                                                </div> -->
                                            </div>

                                            <div class="row py-2">
                                                <div class="col-md-4 mb-2">
                                                    <input type="text" id="searchByName" class="form-control"
                                                        placeholder="Search by Student Name">
                                                </div>
                                                <div class="col-md-4 mb-2">
                                                    <select id="filterByAgainst" class="form-select">
                                                        <option value="">Filter by Grievance Against</option>
                                                        <option value="Student">Student</option>
                                                        <option value="Faculty">Faculty</option>
                                                        <option value="Staff">Staff</option>
                                                        <option value="Admin">Admin</option>
                                                        <option value="Officers">Officers</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-2">
                                                    <select id="filterByStatus" class="form-select">
                                                        <option value="">Filter by Status</option>
                                                        <option value="Pending">Pending</option>
                                                        <option value="In Progress">In Progress</option>
                                                        <option value="Resolved">Resolved</option>
                                                    </select>
                                                </div>
                                            </div>



                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">S.No.</th>
                                                            <th scope="col">Student Name</th>
                                                            <th scope="col">Grievance Against</th>
                                                            <th scope="col">Submitted At</th>
                                                            <th scope="col">View</th>
                                                            <th scope="col">Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="grievanceTableBody">
                                                        <% data.grievances.reverse().forEach((grievance, index)=> { %>
                                                            <tr>
                                                                <td>
                                                                    <%= index + 1 %>.
                                                                </td>
                                                                <td class="studentName">
                                                                    <%= grievance.studentName %>
                                                                </td>
                                                                <td class="grievanceAgainst">
                                                                    <%= grievance.grievanceAgainst %>
                                                                </td>
                                                                <td>
                                                                    <%= grievance.submittedAt.toDateString() %>
                                                                </td>
                                                                <td>
                                                                    <a href="/grievance/view/<%= grievance._id %>"
                                                                        class="btn btn-primary btn-sm">View</a>
                                                                </td>
                                                                <td class="status">
                                                                    <% let statusClass="" ; %>
                                                                        <% if (grievance.status==="Pending" ) {
                                                                            statusClass="text-warning fw-bold" ; } %>
                                                                            <% if (grievance.status==="In Progress" ) {
                                                                                statusClass="text-primary fw-bold" ; }
                                                                                %>
                                                                                <% if (grievance.status==="Resolved" ) {
                                                                                    statusClass="text-success fw-bold" ;
                                                                                    } %>
                                                                                    <span class="<%= statusClass %>">
                                                                                        <%= grievance.status %>
                                                                                    </span>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                    </tbody>

                                                    <tr id="noResultsRow" style="display: none;">
                                                        <td colspan="10" class="text-center fw-bold text-danger">No
                                                            records found</td>
                                                    </tr>

                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- List ends Here     -->
                                </div>
                            </div>
                        </div>
                        <!-- Blank End -->

                        <!-- Footer Start -->
                        <%- include('../partials/MainFooter.ejs')%>
                            <!-- Footer End -->





                </div>
                <!-- Content End -->



                <!-- Back to Top -->
                <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>


    <!-- JavaScript Libraries -->
    <%- include('../partials/MainJSLibrary.ejs')%>
        <script>
            const searchByName = document.getElementById("searchByName");
            const filterByAgainst = document.getElementById("filterByAgainst");
            const filterByStatus = document.getElementById("filterByStatus");
            const tableRows = document.querySelectorAll("#grievanceTableBody tr");
            const noResultsRow = document.getElementById("noResultsRow");

            function filterTable() {
                const nameValue = searchByName.value.trim().toLowerCase();
                const againstValue = filterByAgainst.value.trim().toLowerCase();
                const statusValue = filterByStatus.value.trim().toLowerCase();

                let visibleCount = 0;

                tableRows.forEach(row => {
                    const nameText = row.children[1].textContent.toLowerCase();
                    const againstText = row.children[2].textContent.toLowerCase();
                    const statusText = row.children[5].textContent.toLowerCase();

                    const matchName = nameText.includes(nameValue);
                    const matchAgainst = !againstValue || againstText.includes(againstValue);
                    const matchStatus = !statusValue || statusText.includes(statusValue);

                    if (matchName && matchAgainst && matchStatus) {
                        row.style.display = "";
                        visibleCount++;
                    } else {
                        row.style.display = "none";
                    }
                });

                // Show "No records found" if none are visible
                if (visibleCount === 0) {
                    noResultsRow.style.display = "";
                } else {
                    noResultsRow.style.display = "none";
                }
            }

            searchByName.addEventListener("input", filterTable);
            filterByAgainst.addEventListener("change", filterTable);
            filterByStatus.addEventListener("change", filterTable);
        </script>




</body>

</html>